{% extends "base.html" %} {% block title %}Devices Management{% endblock %} {%
block content %}
<div class="container">
  <h1>Devices Management</h1>

  <div class="card">
    <div class="card-header">
      <h2>Connected Devices</h2>
      <button class="btn btn-primary" id="refresh-devices">
        <span class="material-symbols-rounded">refresh</span> Refresh
      </button>
    </div>
    <div class="card-body">
      <div class="devices-list" id="devices-container">
        <div class="loading">Loading devices...</div>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block scripts %}
<script>
  // Fetch devices from API
  async function fetchDevices() {
    try {
      const response = await fetch("/api/devices/connected");
      if (!response.ok) {
        throw new Error("Failed to fetch devices");
      }
      const data = await response.json();
      displayDevices(data);
    } catch (error) {
      console.error("Error fetching devices:", error);
      document.getElementById(
        "devices-container"
      ).innerHTML = `<div class="error">Error fetching devices: ${error.message}</div>`;
    }
  }

  // Display devices in the UI
  function displayDevices(devices) {
    const container = document.getElementById("devices-container");

    if (!devices || devices.length === 0) {
      container.innerHTML =
        '<div class="no-devices">No devices connected</div>';
      return;
    }

    let html = '<div class="device-grid">';
    devices.forEach((device) => {
      html += `
        <div class="device-card">
          <div class="device-header">
            <h3>${device.model || "Unknown Model"}</h3>
            <span class="device-status ${
              device.status === "device" ? "connected" : "disconnected"
            }">
              ${device.status}
            </span>
          </div>
          <div class="device-info">
            <p><strong>Serial:</strong> ${device.serial}</p>
          </div>
          <div class="device-actions">
            <button class="btn btn-sm btn-info" onclick="viewDevice('${
              device.serial
            }')">
              Details
            </button>
            <button class="btn btn-sm btn-primary" onclick="runCommand('${
              device.serial
            }')">
              Run Command
            </button>
          </div>
        </div>
      `;
    });
    html += "</div>";
    container.innerHTML = html;
  }

  // View device details
  function viewDevice(serial) {
    window.location.href = `/devices/${serial}`;
  }

  // Run a command on device
  function runCommand(serial) {
    // This will be implemented later
    alert(`Run command on device ${serial}`);
  }

  // Initial load
  document.addEventListener("DOMContentLoaded", () => {
    fetchDevices();

    // Refresh button
    document
      .getElementById("refresh-devices")
      .addEventListener("click", fetchDevices);
  });
</script>
{% endblock %}
